<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex">
    <meta name="googlebot" content="noindex">
    <title>Automyynti Hakala</title>
    <link rel="stylesheet" type="text/css" href="styles.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Add Firebase SDKs -->
    <script type="module">
      // Import and configure Firebase
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.16.0/firebase-app.js';
      import { getDatabase, ref, set, get } from 'https://www.gstatic.com/firebasejs/9.16.0/firebase-database.js';

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyDtMJVglgCvbBe8ux4NkTTarfyr8Wtf7RE",
        authDomain: "hakalan-nettisivu.firebaseapp.com",
        databaseURL: "https://hakalan-nettisivu-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "hakalan-nettisivu",
        storageBucket: "hakalan-nettisivu.appspot.com",
        messagingSenderId: "101295643018",
        appId: "1:101295643018:web:fc3e044767c604e74b5073",
        measurementId: "G-FFHLTQ18TJ"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const database = getDatabase(app);
      const dbRef = ref(database, 'editableContent');

      document.addEventListener('DOMContentLoaded', function() {

        let isEditing = false;   // Track edit mode state
        let isLoggedIn = false;
        let failedAttempts = 0; // Track failed login attempts
        const MAX_DELAY = 5000; // Max delay 5 seconds
        const INITIAL_DELAY = 1000; // Initial delay is 1 second

        // Handle login process
        document.getElementById('login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            // Simple username/password check (you can modify this with real logic)
            if (username === 'admin' && password === 'password') {
                isLoggedIn = true;
                failedAttempts = 0; // Reset failed attempts on successful login
                document.getElementById('login').style.display = 'none';
                alert("Login successful!");
            } else {
                failedAttempts += 1;

                // Calculate delay (increase delay with each failed attempt)
                let delay = Math.min(INITIAL_DELAY * failedAttempts, MAX_DELAY);

                // Introduce delay before showing the failure message
                setTimeout(function() {
                    alert("Väärä tunnus tai salasana! (" + failedAttempts + " failed attempts)");
                }, delay);
            }
        });

        function hideMainContent(){
          document.getElementById("mainContent").style.display = "none";
          document.getElementById("closeButton").style.display = "none";
        }
        function showLogin(){
          document.getElementById("login").style.display = "block";
        }

        // Handle edit button functionality
        function handleEditButton() {
          if (!isLoggedIn) {
            // If not logged in, open the login form
            showLogin();
          } else {
            // If logged in, toggle between edit and save mode
            if (!isEditing) {
              enableEdit();
            } else {
              saveEdit();
            }
          }
        }

        // Enable text editing
        function enableEdit() {
          const editableText = document.getElementById('editable');
          editableText.contentEditable = "true";
          editableText.focus();
          isEditing = true;
          // Change the icon of the button to indicate "Save" (floppy disk icon or similar)
          document.getElementById('editButton').classList.remove('fa-edit');
          document.getElementById('editButton').classList.add('fa-save');
        }

        // Save edited content
        function saveEdit() {
          const editableText = document.getElementById('editable').innerHTML;
          set(dbRef, {
            content: editableText
          }).then(() => {
            alert("Muutokset tallennettu!");
            document.getElementById('editButton').classList.remove('fa-save');
            document.getElementById('editButton').classList.add('fa-edit');
            isEditing = false;
          }).catch((error) => {
            console.error("Error saving data: ", error);
          });
        }

        // Load content from Firebase
        get(dbRef).then((snapshot) => {
          if (snapshot.exists()) {
            document.getElementById('editable').innerHTML = snapshot.val().content;
          }
        }).catch((error) => {
          console.error("Error loading data: ", error);
        });

        // Attach event listeners
        document.getElementById('closeButton').addEventListener('click', hideMainContent);
        document.getElementById('editButton').addEventListener('click', handleEditButton);
      });
    </script>
</head>
<body>
    <header>
        <div class="headerContainer">
            <div class="title">
                <h1>Automyynti Hakala</h1>
                <h2>Osto - Myynti - Rahoitus</h2>
            </div>
        </div>
        <div id="login" class="login">
          <script>
            function hideLogin(){
              document.getElementById("login").style.display = "none";
        }
          </script>
            <form id="login-form">
                <button type="button" onclick="hideLogin()" id="closeLogin" class="fa-solid fa-xmark" aria-label="Close"></button>
                <input type="text" placeholder="Käyttäjätunnus" id="username" required>
                <input type="password" placeholder="Salasana" id="password" required>
                <button type="submit" id="login-btn">Kirjaudu</button>
            </form>
        </div>
    </header>
    <div class="wrapper">
        <main class="mainContainer">
            <div class="mainContent" id="mainContent">
                <p id="editable" contenteditable="false">
                    <b>Automyynti Hakala Ay</b> <br>
                    Takojankatu 1 <br>
                    86300 Oulainen <br>
                    <br>
                    <b>Avoinna:</b> <br>
                    Arkisin: 10.00 - 17.15 <br>
                    Lauantaisin: 10.00 - 13.30 <br>
                    <br>
                    <b>Tarjoamme:</b> <br>
                    - Edullisia ja siistejä katsastettuja autoja! <br>
                    - Osto, myynti, vaihto sekä rahoitus! <br>
                    - MITSUBISHI-Ilmalämpöpumput, ammattitaitoiset asennukset<br>
                    <br>
                    <b>Yhteystiedot:</b><br>
                    Liike: (08) 473374 (aukioloaikoina)<br>
                    Esa Hakala: 0400-683243<br>
                    Arto Hakala: 0400-683263<br>
                    autohakala(at)gmail.com<br>
                </p>
            </div>
            <button id="closeButton" class="closeButton fa-solid fa-xmark" aria-label="Close"></button>
            <button id="editButton" class="fas fa-edit"></button>
        </main>
        <div class="iframeContainer">
            <iframe id="myIframe" src="https://www.nettiauto.com/yritys/539535" class="iframeContent"></iframe>
        </div>
    </div>
</body>
</html>
